<div class="top-title" style="display:flex; align-items:center; justify-content:center; gap:0.75rem; padding:0.5rem 1rem; margin-top:0;">
  <%= image_tag "borderline-genius.png", alt: "logo", style: "width:48px; height:48px; object-fit:contain; display:block;" %>
  <h1 style="margin:0; font-size:clamp(1.4rem,4vw,2rem); font-weight:800;">Borderline Genius</h1>
</div>

<style>
  #game-root { margin: 0.25rem auto 0 !important; }
  .top-title h1 { color: #f8fafc; }
  .card-form { display: block; min-width: 160px; text-align: center; cursor: pointer; background: none; border: none; padding: 0; }
  .card-form img { width: 140px; height: 90px; object-fit: cover; border-radius: 8px; box-shadow: 0 6px 18px rgba(0,0,0,0.5); display: block; margin: 0 auto; }
  .card-form:hover img { box-shadow: 0 10px 24px rgba(0,0,0,0.6); }
  .card-form .name { margin-top: 0.75rem; color: #e5e7eb; font-weight: 600; }
  .card-form .value { margin-top: 0.6rem; color: #cbd5e1; font-weight: 700; }
  .card-form.winner img { box-shadow: 0 18px 40px rgba(34,197,94,0.45); }
</style>

<div id="game-root" style="display:flex; align-items:center; justify-content:center; padding:1rem; max-width:720px; margin: 0.5rem auto 0; min-height:50vh;">
  <div id="round" style="background: rgba(255,255,255,0.02); border-radius:12px; padding:2rem; text-align:center;">
    <% if @show_correct_result %>
      <% content_for :head do %><meta http-equiv="refresh" content="1.5; url=<%= root_path %>"><% end %>
      <% cr = @show_correct_result %>
      <div style="color:#cbd5e1; margin-bottom:1.5rem; font-size:clamp(1.1rem,2.4vw,1.6rem); font-weight:700;">Which country had a higher <%= cr[:indicator_label] %><%= " in #{cr[:indicator_year]}" if cr[:indicator_year] %>?</div>
      <div style="display:flex; gap:1.5rem; align-items:center; justify-content:center; margin-top:0.5rem;">
        <div style="min-width:160px;">
          <%= image_tag cr[:left_flag_url], alt: cr[:left_name], style: "width:140px; height:90px; object-fit:cover; border-radius:8px; box-shadow:#{cr[:winner] == cr[:left] ? '0 18px 40px rgba(34,197,94,0.45)' : '0 6px 18px rgba(0,0,0,0.5)'};" %>
          <div class="name" style="margin-top:0.75rem;"><%= cr[:left_name] %></div>
          <div class="value" style="margin-top:0.6rem;"><%= format_stat_value(cr[:left_value]) %></div>
        </div>
        <div style="align-self:center; color:#cbd5e1; font-weight:600;">VS</div>
        <div style="min-width:160px;">
          <%= image_tag cr[:right_flag_url], alt: cr[:right_name], style: "width:140px; height:90px; object-fit:cover; border-radius:8px; box-shadow:#{cr[:winner] == cr[:right] ? '0 18px 40px rgba(34,197,94,0.45)' : '0 6px 18px rgba(0,0,0,0.5)'};" %>
          <div class="name" style="margin-top:0.75rem;"><%= cr[:right_name] %></div>
          <div class="value" style="margin-top:0.6rem;"><%= format_stat_value(cr[:right_value]) %></div>
        </div>
      </div>
      <div style="margin-top:0.75rem; color:#a7f3d0; font-weight:700;">Correct!</div>
      <div style="margin-top:0.75rem; color:#a7f3d0; font-weight:700;">Streak: <%= @streak %></div>
    <% elsif @game_over %>
      <% r = @result %>
      <% rr = @round || session[:result_round] %>
      <% left_iso = rr.is_a?(Hash) ? rr["left"] : rr&.dig(:left) %>
      <% right_iso = rr.is_a?(Hash) ? rr["right"] : rr&.dig(:right) %>
      <% ind = rr.is_a?(Hash) ? rr["indicator"] : rr&.dig(:indicator) %>
      <% left_info = left_iso ? country_info(left_iso) : {} %>
      <% right_info = right_iso ? country_info(right_iso) : {} %>
      <div style="color:#cbd5e1; margin-bottom:1.5rem; font-size:clamp(1.1rem,2.4vw,1.6rem); font-weight:700;">Which country had a higher <%= indicator_label(ind) %><%= " in #{@indicator_year}" if @indicator_year %>?</div>
      <div style="display:flex; gap:1.5rem; align-items:center; justify-content:center; margin-top:0.5rem;">
        <div style="min-width:160px;">
          <%= image_tag left_info[:flag_url], alt: left_info[:name], style: "width:140px; height:90px; object-fit:cover; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.5);" %>
          <div class="name" style="margin-top:0.75rem;"><%= left_info[:name] %></div>
          <div class="value" style="margin-top:0.6rem;"><%= format_stat_value(r["left_value"]) %></div>
        </div>
        <div style="align-self:center; color:#cbd5e1; font-weight:600;">VS</div>
        <div style="min-width:160px;">
          <%= image_tag right_info[:flag_url], alt: right_info[:name], style: "width:140px; height:90px; object-fit:cover; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.5);" %>
          <div class="name" style="margin-top:0.75rem;"><%= right_info[:name] %></div>
          <div class="value" style="margin-top:0.6rem;"><%= format_stat_value(r["right_value"]) %></div>
        </div>
      </div>
      <div style="margin-top:0.75rem; color:#ffb4b4; font-weight:700;">Wrong</div>
      <div style="margin-top:0.75rem; color:#a7f3d0; font-weight:700;">Streak: <%= @streak %></div>
      <div style="margin-top:0.6rem;">
        <%= link_to "Play again", restart_path, class: "btn-secondary", style: "display:inline-block; padding:0.55rem 1rem; border-radius:999px; border:1px solid rgba(148,163,184,0.6); background:transparent; color:#cbd5e1; text-decoration:none;" %>
      </div>
    <% else %>
      <div id="question" style="color:#cbd5e1; margin-bottom:2rem; font-size:clamp(1.1rem,2.4vw,1.6rem); font-weight:700;">Which country had a higher <%= @round[:indicator_label] %><%= " in #{@round[:indicator_year]}" if @round[:indicator_year] %>?</div>
      <div id="players" style="display:flex; gap:1.5rem; align-items:center; justify-content:center; margin-top:0.5rem;">
        <%= form_with url: guess_path, method: :post, local: true, html: { class: "card-form" } do |f| %>
          <%= f.hidden_field :left, value: @round[:left] %>
          <%= f.hidden_field :right, value: @round[:right] %>
          <%= f.hidden_field :indicator, value: @round[:indicator] %>
          <%= f.hidden_field :guess, value: @round[:left] %>
          <button type="submit" style="background:none; border:none; padding:0; cursor:pointer; display:block; width:100%;">
            <%= image_tag @round[:left_flag_url], alt: @round[:left_name], style: "width:140px; height:90px; object-fit:cover; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.5);" %>
            <div class="name"><%= @round[:left_name] %></div>
          </button>
        <% end %>
        <div style="align-self:center; color:#cbd5e1; font-weight:600;">VS</div>
        <%= form_with url: guess_path, method: :post, local: true, html: { class: "card-form" } do |f| %>
          <%= f.hidden_field :left, value: @round[:left] %>
          <%= f.hidden_field :right, value: @round[:right] %>
          <%= f.hidden_field :indicator, value: @round[:indicator] %>
          <%= f.hidden_field :guess, value: @round[:right] %>
          <button type="submit" style="background:none; border:none; padding:0; cursor:pointer; display:block; width:100%;">
            <%= image_tag @round[:right_flag_url], alt: @round[:right_name], style: "width:140px; height:90px; object-fit:cover; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.5);" %>
            <div class="name"><%= @round[:right_name] %></div>
          </button>
        <% end %>
      </div>
      <div id="streak-display" style="margin-top:0.75rem; color:#a7f3d0; font-weight:700;">Streak: <%= @streak %></div>
    <% end %>
  </div>
</div>
